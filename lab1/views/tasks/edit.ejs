<h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</h2>

<form action="/tasks/<%= task.id %>?_method=PUT" method="POST" enctype="multipart/form-data">
  <label>
    –ù–∞–∑–≤–∞–Ω–∏–µ:
    <input type="text" name="title" value="<%= task.title %>" required>
  </label>
  
  <label>
    –û–ø–∏—Å–∞–Ω–∏–µ:
    <textarea name="description"><%= task.description %></textarea>
  </label>
  
  <label>
    –°—Ç–∞—Ç—É—Å:
    <select name="status">
      <option value="todo" <%= task.status === 'todo' ? 'selected' : '' %>>–ù–∞–¥–æ —Å–¥–µ–ª–∞—Ç—å</option>
      <option value="current" <%= task.status === 'current' ? 'selected' : '' %>>–í –ø—Ä–æ—Ü–µ—Å—Å–µ</option>
      <option value="done" <%= task.status === 'done' ? 'selected' : '' %>>–ì–æ—Ç–æ–≤–æ</option>
    </select>
  </label>
  
  <label>
    –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
    <input type="date" name="due_date" value="<%= task.due_date ? task.due_date.split('T')[0] : '' %>">
  </label>
  
  <label>
    –î–æ–±–∞–≤–∏—Ç—å –≤–ª–æ–∂–µ–Ω–∏—è:
    <input type="file" name="attachments" multiple>
  </label>
  
  <% if (task.attachments && task.attachments.length > 0) { %>
    <h4>–í–ª–æ–∂–µ–Ω–∏—è:</h4>
    <ul>
      <% task.attachments.forEach(att => { %>
        <li>
          <a href="/tasks/<%= task.id %>/attachments/<%= att.id %>" target="_blank">
            üìé <%= att.original_name %>
          </a>
          <button class="delete-attachment" data-task="<%= task.id %>" data-attachment="<%= att.id %>">–£–¥–∞–ª–∏—Ç—å</button>
        </li>
      <% }) %>
    </ul>
  <% } %>

  <button class="save-changes" type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</form>

<script>
document.querySelectorAll('.delete-attachment').forEach(btn => {
  btn.addEventListener('click', () => {
    const taskId = btn.dataset.task;
    const attId = btn.dataset.attachment;

    fetch(`/tasks/${taskId}/attachments/${attId}?_method=DELETE`, {
      method: 'POST'
    }).then(() => {
      location.reload();
    });
  });
});
</script>